# RabbitMQ 配置文件 - CNI-BBS-TitanCore
# 文档: https://www.rabbitmq.com/configure.html

## ==================== 监听配置 ====================
# AMQP 协议端口（默认 5672）
listeners.tcp.default = 5672

# 管理界面端口（默认 15672）
management.tcp.port = 15672

## ==================== 虚拟主机配置 ====================
# 默认虚拟主机（会自动创建）
# default_vhost = /titan-bbs

## ==================== 用户和权限配置 ====================
# 默认用户（通过环境变量设置）
# default_user = titan_bbs
# default_pass = titan_bbs_2025

# Erlang Cookie（集群认证用，单节点可忽略）
# cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config

## ==================== 性能配置 ====================
# 磁盘可用空间阈值（50MB）
disk_free_limit.absolute = 50MB

# 内存高水位阈值（0.4 = 40% 的可用内存）
vm_memory_high_watermark.relative = 0.4

# 消息最大大小（512MB）
max_message_size = 536870912

# 心跳超时（秒）
heartbeat = 60

## ==================== 管理插件配置 ====================
# 管理界面路径前缀
# management.path_prefix = /rabbitmq

# 管理界面跨域设置（简化配置，兼容 RabbitMQ 3.12）
management.cors.allow_origins.1 = *

## ==================== 日志配置 ====================
# 日志级别: debug, info, warning, error, critical, none
log.console.level = info
log.file.level = info

# 日志文件路径
log.dir = /var/log/rabbitmq
log.file = rabbit.log

## ==================== 消息持久化配置 ====================
# 队列索引嵌入阈值
queue_index_embed_msgs_below = 4096

# 消息存储目录
# mnesia_base = /var/lib/rabbitmq/mnesia

## ==================== 连接配置 ====================
# TCP 监听选项
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.exit_on_close = false

# 通道最大数量（每个连接）
channel_max = 2048

## ==================== 集群配置（单节点可忽略）====================
# cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config
# cluster_partition_handling = autoheal

## ==================== 插件配置 ====================
# 以下插件通过 enabled_plugins 文件启用
# - rabbitmq_management (管理界面)
# - rabbitmq_management_agent (管理 API)
# - rabbitmq_prometheus (Prometheus 监控)
