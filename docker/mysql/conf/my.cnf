# MySQL 8.0 配置文件 - CNI-BBS-TitanCore

[mysqld]
# ==================== 基础配置 ====================
# 服务器 ID（集群环境需唯一）
server-id = 1
# 端口
port = 3306
# 数据目录
datadir = /var/lib/mysql
# Socket 文件
socket = /var/run/mysqld/mysqld.sock

# ==================== 字符集配置 ====================
# 默认字符集 UTF-8
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
# 跳过外部字符集检查
skip-character-set-client-handshake

# ==================== 时区配置 ====================
default-time-zone = '+08:00'

# ==================== 连接配置 ====================
# 最大连接数
max_connections = 500
# 最大错误连接数
max_connect_errors = 100
# 允许的最大包大小（64MB）
max_allowed_packet = 64M

# ==================== 安全配置 ====================
# 禁用本地文件加载（防止 SQL 注入）
local_infile = 0
# SQL 模式（严格模式）
sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION

# ==================== 性能优化 ====================
# InnoDB 缓冲池大小（建议设置为物理内存的 50-80%，这里设置 512MB）
innodb_buffer_pool_size = 512M
# InnoDB 日志文件大小
innodb_log_file_size = 128M
# InnoDB 日志缓冲区大小
innodb_log_buffer_size = 16M
# InnoDB 刷新日志策略（1 = 每次提交都刷新，安全性最高）
innodb_flush_log_at_trx_commit = 1
# InnoDB 刷新方法
innodb_flush_method = O_DIRECT
# InnoDB IO 容量
innodb_io_capacity = 200
innodb_io_capacity_max = 2000

# ==================== 查询缓存（MySQL 8.0 已移除）====================
# MySQL 8.0 不再支持查询缓存

# ==================== 临时表配置 ====================
tmp_table_size = 64M
max_heap_table_size = 64M

# ==================== 日志配置 ====================
# 错误日志
log_error = /var/log/mysql/error.log
# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1

# 二进制日志（用于主从复制和数据恢复）
log_bin = /var/lib/mysql/mysql-bin
binlog_format = ROW
binlog_expire_logs_seconds = 604800
max_binlog_size = 100M

# ==================== 表配置 ====================
# 表名大小写敏感（0 = 敏感，1 = 不敏感，2 = 存储时小写）
lower_case_table_names = 1

# ==================== MyISAM 配置 ====================
key_buffer_size = 32M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
sort_buffer_size = 8M
join_buffer_size = 8M

# ==================== 其他配置 ====================
# 跳过 DNS 解析（提升连接速度）
skip-name-resolve
# 禁用符号链接
symbolic-links = 0

[client]
# 客户端默认字符集
default-character-set = utf8mb4
# Socket 文件
socket = /var/run/mysqld/mysqld.sock

[mysql]
# MySQL 命令行工具默认字符集
default-character-set = utf8mb4
